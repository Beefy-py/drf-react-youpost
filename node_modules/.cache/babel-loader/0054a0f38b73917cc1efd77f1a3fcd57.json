{"ast":null,"code":"import _objectSpread from\"C:/Users/kenny/Projects/DRF_React_YouPost/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _classCallCheck from\"C:/Users/kenny/Projects/DRF_React_YouPost/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"C:/Users/kenny/Projects/DRF_React_YouPost/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"C:/Users/kenny/Projects/DRF_React_YouPost/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"C:/Users/kenny/Projects/DRF_React_YouPost/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from\"react\";import{Link}from\"react-router-dom\";import UserContext from\"./../../context/userContext\";import ReactTooltip from\"react-tooltip\";import axiosInstance from\"./../../baseAxios\";import DarkContext from\"./../../context/darkMode\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var SingularPost=/*#__PURE__*/function(_Component){_inherits(SingularPost,_Component);var _super=_createSuper(SingularPost);function SingularPost(){var _this;_classCallCheck(this,SingularPost);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={rating:0,users:[],currentUserId:JSON.parse(atob(localStorage.getItem(\"access_token\").split(\".\")[1])).user_id,currentUser:{},likeClass:\"btn btn-outline-dark\",dislikeClass:\"btn btn-outline-dark\",bookmarkClass:\"btn btn-outline-dark\",bookmarkDataTip:\"add to bookmarks\"};_this.addBookmark=function(post){var _this$state=_this.state,currentUser=_this$state.currentUser,currentUserId=_this$state.currentUserId;var bookmarked;bookmarked=currentUser.bookmarked;console.log(\"\\n before\",currentUser.bookmarked);if(currentUser.bookmarked.includes(post.id)){bookmarked.splice(bookmarked.indexOf(post.id),1);_this.setState({bookmarkClass:\"btn btn-outline-dark\"});_this.setState({bookmarkDataTip:\"add to bookmarks\"});}else{bookmarked.push(post.id);_this.setState({bookmarkClass:\"btn btn-info\"});_this.setState({bookmarkDataTip:\"remove from bookmarks\"});}currentUser.bookmarked=bookmarked;console.log(\"\\n after\",currentUser.bookmarked);axiosInstance.put(\"user/list/\"+currentUserId,_objectSpread(_objectSpread({},currentUser),{},{bookmarked:bookmarked}));window.location.replace(\"/dashboard\");};_this.getRatingColor=function(rate){var prefix=\"rate badge \";if(rate>999999999)return prefix+\"rate1b\";if(rate>999999)return prefix+\"rate1m\";if(rate>99999)return prefix+\"rate100k\";if(rate>999)return prefix+\"rate1k\";if(rate>0)return prefix+\"before1k\";if(rate===0)return prefix+\"rate0\";if(rate<-999999999)return prefix+\"rate-1b\";if(rate<-999999)return prefix+\"rate-1m\";if(rate<-99999)return prefix+\"rate-100k\";if(rate<-999)return prefix+\"rate-1k\";if(rate<0)return prefix+\"before-1k\";return prefix+\"badge-primary\";};return _this;}_createClass(SingularPost,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;axiosInstance.get(\"user/list/\").then(function(res){_this2.setState({users:res.data});});axiosInstance.get(\"posts/\"+this.props.post.slug).then(function(res){return _this2.setState({rating:res.data.rating});});axiosInstance.get(\"user/list/\"+this.state.currentUserId).then(function(res){_this2.setState({currentUser:res.data});var post=_this2.props.post;if(res.data.liked.includes(post.id)){_this2.setState({likeClass:\"btn btn-success disabled\"});_this2.setState({dislikeClass:\"btn btn-outline-dark disabled\"});}if(res.data.disliked.includes(post.id)){// console.log(`${res.data.username} has already disliked  ${post.title}`);\n_this2.setState({dislikeClass:\"btn btn-danger disabled\"});_this2.setState({likeClass:\"btn btn-outline-dark disabled\"});}if(res.data.bookmarked.includes(post.id)){_this2.setState({bookmarkClass:\"btn btn-info\"});_this2.setState({bookmarkDataTip:\"remove from bookmarks\"});}});}},{key:\"changeRating\",value:function changeRating(post,value){var _this$state2=this.state,rating=_this$state2.rating,currentUser=_this$state2.currentUser,currentUserId=_this$state2.currentUserId;var restPost={title:post.title,slug:post.slug,content:post.content,author:post.author,published:post.published};var likedPosts=currentUser.liked;var dislikedPosts=currentUser.disliked;if(value===1){likedPosts.push(post.id);console.log(currentUser.username+\" liked \"+post.title+\" with id \"+post.id);}else{dislikedPosts.push(post.id);console.log(currentUser.username+\" disliked \"+post.title+\" with id \"+post.id);}currentUser.liked=likedPosts;currentUser.dislike=dislikedPosts;if(currentUser.liked.includes(post.id)){this.setState({likeClass:\"btn btn-success disabled\"});this.setState({dislikeClass:\"btn btn-outline-dark disabled\"});}if(currentUser.disliked.includes(post.id)){this.setState({dislikeClass:\"btn btn-danger disabled\"});this.setState({likeClass:\"btn btn-outline-dark disabled\"});}axiosInstance.put(\"user/list/\"+currentUserId,currentUser);this.setState({rating:rating+value});axiosInstance.put(\"update-post/\"+post.slug,_objectSpread(_objectSpread({},restPost),{},{rating:rating+value}));window.location.replace(\"posts/\"+post.slug);}},{key:\"render\",value:function render(){var _this3=this;var _this$props=this.props,title=_this$props.title,content=_this$props.content,slug=_this$props.slug,author=_this$props.author,image=_this$props.image,postDate=_this$props.postDate,day=_this$props.day,dataType=_this$props.dataType,post=_this$props.post,getRatingSuffix=_this$props.getRatingSuffix;var _this$state3=this.state,likeClass=_this$state3.likeClass,dislikeClass=_this$state3.dislikeClass,bookmarkClass=_this$state3.bookmarkClass,bookmarkDataTip=_this$state3.bookmarkDataTip;var rating=this.state.rating;var currentUser=this.state.users.filter(function(user){return user.username==localStorage.getItem(\"currentUser\");})[0];return/*#__PURE__*/_jsxs(\"div\",{className:this.context.darkMode?\"blog-post text-light border bg-dark\":\"blog-post border\",children:[/*#__PURE__*/_jsx(ReactTooltip,{}),/*#__PURE__*/_jsx(\"div\",{className:\"blog-post-img border\",children:/*#__PURE__*/_jsx(\"img\",{src:image,alt:\"Image for: \"+title})}),/*#__PURE__*/_jsxs(\"div\",{className:\"blog-post-info\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"blog-post-date\",children:[/*#__PURE__*/_jsx(\"span\",{children:day}),/*#__PURE__*/_jsx(\"span\",{children:postDate})]}),/*#__PURE__*/_jsx(\"div\",{className:\"blog-post-author\",children:/*#__PURE__*/_jsx(UserContext.Consumer,{children:function children(userContext){return/*#__PURE__*/_jsxs(React.Fragment,{children:[\"by \",/*#__PURE__*/_jsx(\"span\",{children:userContext.getAuthor(author)})]});}})}),/*#__PURE__*/_jsx(\"h1\",{className:\"blog-post-title\",children:title}),/*#__PURE__*/_jsx(\"p\",{className:\"blog-post-text\",children:content.length>=500?content.substring(0,500)+\"...\":content}),/*#__PURE__*/_jsx(Link,{to:\"posts/\"+slug,className:\"blog-post-cta\",children:\"Read More\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"blog-post-options\",children:[/*#__PURE__*/_jsx(\"div\",{className:this.getRatingColor(rating),children:/*#__PURE__*/_jsx(\"span\",{\"data-tip\":\"rating: \"+rating.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g,\",\"),\"data-type\":dataType,children:getRatingSuffix(rating)})}),currentUser?/*#__PURE__*/_jsx(React.Fragment,{children:author===currentUser.id?/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-info-circle\"}):/*#__PURE__*/_jsxs(React.Fragment,{children:[/*#__PURE__*/_jsx(ReactTooltip,{}),/*#__PURE__*/_jsxs(\"div\",{className:\"react\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"upvote\",children:/*#__PURE__*/_jsx(\"button\",{className:likeClass,\"data-tip\":\"like\",\"data-type\":dataType,onClick:function onClick(){return _this3.changeRating(post,1);},children:/*#__PURE__*/_jsx(\"i\",{className:\"far fa-thumbs-up\"})})}),/*#__PURE__*/_jsx(\"div\",{className:\"downvote\",children:/*#__PURE__*/_jsx(\"button\",{className:dislikeClass,\"data-tip\":\"dislike\",\"data-type\":dataType,onClick:function onClick(){return _this3.changeRating(post,-1);},children:/*#__PURE__*/_jsx(\"i\",{className:\"far fa-thumbs-down\"})})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"other-react\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"bookmark\",children:/*#__PURE__*/_jsx(\"button\",{className:bookmarkClass,\"data-tip\":bookmarkDataTip,\"data-type\":dataType,onClick:function onClick(){return _this3.addBookmark(post);},children:/*#__PURE__*/_jsx(\"i\",{className:\"far fa-bookmark\"})})}),/*#__PURE__*/_jsx(\"div\",{className:\"comment\",\"data-tip\":\"comment on this post\",\"data-type\":dataType,children:/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-dark\",children:/*#__PURE__*/_jsx(\"i\",{style:{fontSize:\".8rem\"},className:\"far fa-comment-alt\"})})})]})]})}):\"\"]})]},post.id);}}]);return SingularPost;}(Component);SingularPost.contextType=DarkContext;export{SingularPost as default};","map":{"version":3,"sources":["C:/Users/kenny/Projects/drf_react_youpost/src/components/content/singularPost.jsx"],"names":["React","Component","Link","UserContext","ReactTooltip","axiosInstance","DarkContext","SingularPost","state","rating","users","currentUserId","JSON","parse","atob","localStorage","getItem","split","user_id","currentUser","likeClass","dislikeClass","bookmarkClass","bookmarkDataTip","addBookmark","post","bookmarked","console","log","includes","id","splice","indexOf","setState","push","put","window","location","replace","getRatingColor","rate","prefix","get","then","res","data","props","slug","liked","disliked","value","restPost","title","content","author","published","likedPosts","dislikedPosts","username","dislike","image","postDate","day","dataType","getRatingSuffix","filter","user","context","darkMode","userContext","getAuthor","length","substring","toString","changeRating","fontSize","contextType"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\r\nimport { Link } from \"react-router-dom\";\r\nimport UserContext from \"./../../context/userContext\";\r\nimport ReactTooltip from \"react-tooltip\";\r\nimport axiosInstance from \"./../../baseAxios\";\r\nimport DarkContext from \"./../../context/darkMode\";\r\n\r\nexport default class SingularPost extends Component {\r\n  state = {\r\n    rating: 0,\r\n    users: [],\r\n    currentUserId: JSON.parse(\r\n      atob(localStorage.getItem(\"access_token\").split(\".\")[1])\r\n    ).user_id,\r\n    currentUser: {},\r\n    likeClass: \"btn btn-outline-dark\",\r\n    dislikeClass: \"btn btn-outline-dark\",\r\n    bookmarkClass: \"btn btn-outline-dark\",\r\n    bookmarkDataTip: \"add to bookmarks\",\r\n  };\r\n\r\n  static contextType = DarkContext;\r\n\r\n  componentDidMount() {\r\n    axiosInstance.get(\"user/list/\").then((res) => {\r\n      this.setState({ users: res.data });\r\n    });\r\n\r\n    axiosInstance\r\n      .get(\"posts/\" + this.props.post.slug)\r\n      .then((res) => this.setState({ rating: res.data.rating }));\r\n\r\n    axiosInstance.get(\"user/list/\" + this.state.currentUserId).then((res) => {\r\n      this.setState({ currentUser: res.data });\r\n\r\n      const { post } = this.props;\r\n\r\n      if (res.data.liked.includes(post.id)) {\r\n        this.setState({ likeClass: \"btn btn-success disabled\" });\r\n        this.setState({ dislikeClass: \"btn btn-outline-dark disabled\" });\r\n      }\r\n\r\n      if (res.data.disliked.includes(post.id)) {\r\n        // console.log(`${res.data.username} has already disliked  ${post.title}`);\r\n        this.setState({ dislikeClass: \"btn btn-danger disabled\" });\r\n        this.setState({ likeClass: \"btn btn-outline-dark disabled\" });\r\n      }\r\n\r\n      if (res.data.bookmarked.includes(post.id)) {\r\n        this.setState({ bookmarkClass: \"btn btn-info\" });\r\n        this.setState({ bookmarkDataTip: \"remove from bookmarks\" });\r\n      }\r\n    });\r\n  }\r\n\r\n  changeRating(post, value) {\r\n    const { rating, currentUser, currentUserId } = this.state;\r\n\r\n    const restPost = {\r\n      title: post.title,\r\n      slug: post.slug,\r\n      content: post.content,\r\n      author: post.author,\r\n      published: post.published,\r\n    };\r\n\r\n    let likedPosts = currentUser.liked;\r\n    let dislikedPosts = currentUser.disliked;\r\n\r\n    if (value === 1) {\r\n      likedPosts.push(post.id);\r\n      console.log(\r\n        currentUser.username + \" liked \" + post.title + \" with id \" + post.id\r\n      );\r\n    } else {\r\n      dislikedPosts.push(post.id);\r\n      console.log(\r\n        currentUser.username + \" disliked \" + post.title + \" with id \" + post.id\r\n      );\r\n    }\r\n\r\n    currentUser.liked = likedPosts;\r\n    currentUser.dislike = dislikedPosts;\r\n\r\n    if (currentUser.liked.includes(post.id)) {\r\n      this.setState({ likeClass: \"btn btn-success disabled\" });\r\n      this.setState({ dislikeClass: \"btn btn-outline-dark disabled\" });\r\n    }\r\n\r\n    if (currentUser.disliked.includes(post.id)) {\r\n      this.setState({ dislikeClass: \"btn btn-danger disabled\" });\r\n      this.setState({ likeClass: \"btn btn-outline-dark disabled\" });\r\n    }\r\n\r\n    axiosInstance.put(\"user/list/\" + currentUserId, currentUser);\r\n\r\n    this.setState({ rating: rating + value });\r\n\r\n    axiosInstance.put(\"update-post/\" + post.slug, {\r\n      ...restPost,\r\n      rating: rating + value,\r\n    });\r\n\r\n    window.location.replace(\"posts/\" + post.slug);\r\n  }\r\n\r\n  addBookmark = (post) => {\r\n    const { currentUser, currentUserId } = this.state;\r\n    let bookmarked;\r\n    bookmarked = currentUser.bookmarked;\r\n    console.log(\"\\n before\", currentUser.bookmarked);\r\n\r\n    if (currentUser.bookmarked.includes(post.id)) {\r\n      bookmarked.splice(bookmarked.indexOf(post.id), 1);\r\n      this.setState({ bookmarkClass: \"btn btn-outline-dark\" });\r\n      this.setState({ bookmarkDataTip: \"add to bookmarks\" });\r\n    } else {\r\n      bookmarked.push(post.id);\r\n      this.setState({ bookmarkClass: \"btn btn-info\" });\r\n      this.setState({ bookmarkDataTip: \"remove from bookmarks\" });\r\n    }\r\n\r\n    currentUser.bookmarked = bookmarked;\r\n    console.log(\"\\n after\", currentUser.bookmarked);\r\n\r\n    axiosInstance.put(\"user/list/\" + currentUserId, {\r\n      ...currentUser,\r\n      bookmarked: bookmarked,\r\n    });\r\n\r\n    window.location.replace(\"/dashboard\");\r\n  };\r\n\r\n  getRatingColor = (rate) => {\r\n    const prefix = \"rate badge \";\r\n\r\n    if (rate > 999999999) return prefix + \"rate1b\";\r\n    if (rate > 999999) return prefix + \"rate1m\";\r\n    if (rate > 99999) return prefix + \"rate100k\";\r\n    if (rate > 999) return prefix + \"rate1k\";\r\n    if (rate > 0) return prefix + \"before1k\";\r\n    if (rate === 0) return prefix + \"rate0\";\r\n    if (rate < -999999999) return prefix + \"rate-1b\";\r\n    if (rate < -999999) return prefix + \"rate-1m\";\r\n    if (rate < -99999) return prefix + \"rate-100k\";\r\n    if (rate < -999) return prefix + \"rate-1k\";\r\n    if (rate < 0) return prefix + \"before-1k\";\r\n\r\n    return prefix + \"badge-primary\";\r\n  };\r\n  render() {\r\n    const {\r\n      title,\r\n      content,\r\n      slug,\r\n      author,\r\n      image,\r\n      postDate,\r\n      day,\r\n      dataType,\r\n      post,\r\n\r\n      getRatingSuffix,\r\n    } = this.props;\r\n\r\n    const { likeClass, dislikeClass, bookmarkClass, bookmarkDataTip } =\r\n      this.state;\r\n\r\n    const rating = this.state.rating;\r\n    const currentUser = this.state.users.filter(\r\n      (user) => user.username == localStorage.getItem(\"currentUser\")\r\n    )[0];\r\n\r\n    return (\r\n      <div\r\n        key={post.id}\r\n        className={\r\n          this.context.darkMode\r\n            ? \"blog-post text-light border bg-dark\"\r\n            : \"blog-post border\"\r\n        }\r\n      >\r\n        <ReactTooltip />\r\n        <div className=\"blog-post-img border\">\r\n          <img src={image} alt={\"Image for: \" + title} />\r\n        </div>\r\n        <div className=\"blog-post-info\">\r\n          <div className=\"blog-post-date\">\r\n            <span>{day}</span>\r\n            <span>{postDate}</span>\r\n          </div>\r\n          <div className=\"blog-post-author\">\r\n            <UserContext.Consumer>\r\n              {(userContext) => {\r\n                return (\r\n                  <React.Fragment>\r\n                    by <span>{userContext.getAuthor(author)}</span>\r\n                  </React.Fragment>\r\n                );\r\n              }}\r\n            </UserContext.Consumer>\r\n          </div>\r\n\r\n          <h1 className=\"blog-post-title\">{title}</h1>\r\n          <p className=\"blog-post-text\">\r\n            {content.length >= 500\r\n              ? content.substring(0, 500) + \"...\"\r\n              : content}\r\n          </p>\r\n          <Link to={\"posts/\" + slug} className=\"blog-post-cta\">\r\n            Read More\r\n          </Link>\r\n        </div>\r\n        <div className=\"blog-post-options\">\r\n          <div className={this.getRatingColor(rating)}>\r\n            <span\r\n              data-tip={\r\n                \"rating: \" +\r\n                rating.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\")\r\n              }\r\n              data-type={dataType}\r\n            >\r\n              {getRatingSuffix(rating)}\r\n            </span>\r\n          </div>\r\n          {currentUser ? (\r\n            <React.Fragment>\r\n              {author === currentUser.id ? (\r\n                <i className=\"fas fa-info-circle\"></i>\r\n              ) : (\r\n                <React.Fragment>\r\n                  <ReactTooltip />\r\n                  <div className=\"react\">\r\n                    <div className=\"upvote\">\r\n                      <button\r\n                        className={likeClass}\r\n                        data-tip=\"like\"\r\n                        data-type={dataType}\r\n                        onClick={() => this.changeRating(post, 1)}\r\n                      >\r\n                        <i className=\"far fa-thumbs-up\"></i>\r\n                      </button>\r\n                    </div>\r\n                    <div className=\"downvote\">\r\n                      <button\r\n                        className={dislikeClass}\r\n                        data-tip=\"dislike\"\r\n                        data-type={dataType}\r\n                        onClick={() => this.changeRating(post, -1)}\r\n                      >\r\n                        <i className=\"far fa-thumbs-down\"></i>\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"other-react\">\r\n                    <div className=\"bookmark\">\r\n                      <button\r\n                        className={bookmarkClass}\r\n                        data-tip={bookmarkDataTip}\r\n                        data-type={dataType}\r\n                        onClick={() => this.addBookmark(post)}\r\n                      >\r\n                        <i className=\"far fa-bookmark\"></i>\r\n                        {/* <i className=\"fas fa-bookmark\"></i> */}\r\n                      </button>\r\n                    </div>\r\n                    <div\r\n                      className=\"comment\"\r\n                      data-tip=\"comment on this post\"\r\n                      data-type={dataType}\r\n                    >\r\n                      <button className=\"btn btn-dark\">\r\n                        <i\r\n                          style={{ fontSize: \".8rem\" }}\r\n                          className=\"far fa-comment-alt\"\r\n                        ></i>\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                </React.Fragment>\r\n              )}\r\n            </React.Fragment>\r\n          ) : (\r\n            \"\"\r\n          )}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}