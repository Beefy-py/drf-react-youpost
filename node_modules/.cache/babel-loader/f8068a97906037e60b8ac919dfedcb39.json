{"ast":null,"code":"import _classCallCheck from\"C:/Users/kenny/Projects/DRF_React_YouPost/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"C:/Users/kenny/Projects/DRF_React_YouPost/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"C:/Users/kenny/Projects/DRF_React_YouPost/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"C:/Users/kenny/Projects/DRF_React_YouPost/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import Form from\"../common/form\";import Joi from\"joi-browser\";import React from\"react\";import UserContext from\"../../context/userContext\";import apiURL from\"../../apiUrl\";import axiosInstance from\"../../baseAxios\";import DarkContext from\"../../context/darkMode\";import{Link}from\"react-router-dom\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var LoginForm=/*#__PURE__*/function(_Form){_inherits(LoginForm,_Form);var _super=_createSuper(LoginForm);function LoginForm(){var _this;_classCallCheck(this,LoginForm);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={data:{username:\"\",password:\"\"},errors:{}};_this.schema={username:Joi.string().required().label(\"Username\"),password:Joi.string().required().min(5).label(\"Password\")};_this.afterSubmit=function(){axiosInstance.post(apiURL+\"token/\",{username:_this.state.data.username,password:_this.state.data.password}).then(function(res){localStorage.setItem(\"access_token\",res.data.access);localStorage.setItem(\"refresh_token\",res.data.refresh);axiosInstance.defaults.headers[\"Authorization\"]=\"JWT \"+localStorage.getItem(\"access_token\");/*set user to current user */_this.context.onLogIn(_this.state.data.username);localStorage.setItem(\"currentUser\",_this.state.data.username);_this.props.history.replace(\"/dashboard\");}).catch(function(response){console.log(response.response);var errorText=response.response.data.detail?\"username or password incorrect\":\"\";var errors401={username:errorText,password:errorText};_this.setState({errors:errors401});});};return _this;}_createClass(LoginForm,[{key:\"componentDidMount\",value:function componentDidMount(){this.context.onLogIn(\"Guest\");this.props.toggleShowSearchBar(false);}},{key:\"afterChange\",value:function afterChange(input){}},{key:\"render\",value:function render(){var _this2=this;return/*#__PURE__*/_jsx(DarkContext.Consumer,{children:function children(darkContext){return/*#__PURE__*/_jsxs(\"div\",{className:\"form-container border \"+\"\".concat(darkContext.darkMode?\"bg-dark text-light\":\"bg-light\"),children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Login\"}),/*#__PURE__*/_jsxs(\"form\",{action:\"\",onSubmit:_this2.handleSubmit,children:[_this2.renderInput(\"username\",\"Username\"),_this2.renderInput(\"password\",\"Password\",\"password\"),_this2.renderButton(\"Login\")]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Don't have an account? \",/*#__PURE__*/_jsx(Link,{to:\"/register\",children:\"Register\"})]})]});}});}}]);return LoginForm;}(Form);LoginForm.contextType=UserContext;export{LoginForm as default};","map":{"version":3,"sources":["C:/Users/kenny/Projects/drf_react_youpost/src/components/actions/loginForm.jsx"],"names":["Form","Joi","React","UserContext","apiURL","axiosInstance","DarkContext","Link","LoginForm","state","data","username","password","errors","schema","string","required","label","min","afterSubmit","post","then","res","localStorage","setItem","access","refresh","defaults","headers","getItem","context","onLogIn","props","history","replace","catch","response","console","log","errorText","detail","errors401","setState","toggleShowSearchBar","input","darkContext","darkMode","handleSubmit","renderInput","renderButton","contextType"],"mappings":"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","sourcesContent":["import Form from \"../common/form\";\r\nimport Joi from \"joi-browser\";\r\nimport React from \"react\";\r\nimport UserContext from \"../../context/userContext\";\r\nimport apiURL from \"../../apiUrl\";\r\nimport axiosInstance from \"../../baseAxios\";\r\nimport DarkContext from \"../../context/darkMode\";\r\nimport { Link } from \"react-router-dom\";\r\n\r\nexport default class LoginForm extends Form {\r\n  static contextType = UserContext;\r\n\r\n  componentDidMount() {\r\n    this.context.onLogIn(\"Guest\");\r\n    this.props.toggleShowSearchBar(false);\r\n  }\r\n\r\n  state = {\r\n    data: { username: \"\", password: \"\" },\r\n    errors: {},\r\n  };\r\n\r\n  schema = {\r\n    username: Joi.string().required().label(\"Username\"),\r\n    password: Joi.string().required().min(5).label(\"Password\"),\r\n  };\r\n\r\n  afterSubmit = () => {\r\n    axiosInstance\r\n      .post(apiURL + \"token/\", {\r\n        username: this.state.data.username,\r\n        password: this.state.data.password,\r\n      })\r\n      .then((res) => {\r\n        localStorage.setItem(\"access_token\", res.data.access);\r\n        localStorage.setItem(\"refresh_token\", res.data.refresh);\r\n        axiosInstance.defaults.headers[\"Authorization\"] =\r\n          \"JWT \" + localStorage.getItem(\"access_token\");\r\n\r\n        /*set user to current user */\r\n        this.context.onLogIn(this.state.data.username);\r\n        localStorage.setItem(\"currentUser\", this.state.data.username);\r\n        this.props.history.replace(\"/dashboard\");\r\n      })\r\n      .catch((response) => {\r\n        console.log(response.response);\r\n        const errorText = response.response.data.detail\r\n          ? \"username or password incorrect\"\r\n          : \"\";\r\n\r\n        const errors401 = { username: errorText, password: errorText };\r\n        this.setState({ errors: errors401 });\r\n      });\r\n  };\r\n\r\n  afterChange(input) {}\r\n\r\n  render() {\r\n    return (\r\n      <DarkContext.Consumer>\r\n        {(darkContext) => (\r\n          <div\r\n            className={\r\n              \"form-container border \" +\r\n              `${darkContext.darkMode ? \"bg-dark text-light\" : \"bg-light\"}`\r\n            }\r\n          >\r\n            <h1>Login</h1>\r\n            <form action=\"\" onSubmit={this.handleSubmit}>\r\n              {this.renderInput(\"username\", \"Username\")}\r\n              {this.renderInput(\"password\", \"Password\", \"password\")}\r\n              {this.renderButton(\"Login\")}\r\n            </form>\r\n            <p>\r\n              Don't have an account? <Link to=\"/register\">Register</Link>\r\n            </p>\r\n          </div>\r\n        )}\r\n      </DarkContext.Consumer>\r\n    );\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}