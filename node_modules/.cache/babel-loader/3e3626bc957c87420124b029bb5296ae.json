{"ast":null,"code":"import _objectWithoutProperties from\"C:/Users/kenny/Projects/DRF_React_YouPost/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";import _objectSpread from\"C:/Users/kenny/Projects/DRF_React_YouPost/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _classCallCheck from\"C:/Users/kenny/Projects/DRF_React_YouPost/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"C:/Users/kenny/Projects/DRF_React_YouPost/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"C:/Users/kenny/Projects/DRF_React_YouPost/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"C:/Users/kenny/Projects/DRF_React_YouPost/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";var _excluded=[\"component\",\"toggleShowSearchBar\",\"users\"],_excluded2=[\"component\",\"toggleShowSearchBar\",\"users\"];import Header from\"./components/content/header\";import Footer from\"./components/content/footer\";import Body from\"./components/content/body\";import{Route,BrowserRouter as Router,Switch,Redirect}from\"react-router-dom\";import React,{Component}from\"react\";import RegisterForm from\"./components/actions/registerForm\";import LoginForm from\"./components/actions/loginForm\";import Logout from\"./components/actions/logout\";import SearchPage from\"./components/content/searchPage\";import CreatePost from\"./components/actions/createPost\";import UserContext from\"./context/userContext\";import DarkContext from\"./context/darkMode\";import apiURL from\"./apiUrl\";import axios from\"axios\";import SearchBar from\"./components/actions/searchBar\";import PostDetailWrapper from\"./components/content/postDetailWrapper\";import NotFoundPage from\"./components/content/notFoundPage\";import UpdatePost from\"./components/actions/updatePost\";import DeletePost from\"./components/actions/deletePost\";import Dashboard from\"./components/content/dashboard\";import axiosInstance from\"./baseAxios\";import AdminPage from\"./components/admin/adminPage\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var App=/*#__PURE__*/function(_Component){_inherits(App,_Component);var _super=_createSuper(App);function App(){var _this;_classCallCheck(this,App);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={currentUser:{name:\"\"},users:[],darkMode:false,showSearchBar:true};_this.handleLoggedIn=function(username){var user={name:username};_this.setState({currentUser:user});};_this.getAuthorById=function(pk){if(pk){var userName=_this.state.users.find(function(user){return user.id===pk;})?_this.state.users.find(function(user){return user.id===pk;}).username:\"Anonymous\";return userName;}};_this.toggleDarkMode=function(){_this.setState({darkMode:!_this.state.darkMode});_this.makePageDark();};_this.toggleShowSearchBar=function(boolInp){_this.setState({showSearchBar:boolInp});};_this.makePageDark=function(){document.querySelector(\"html\").className=!_this.state.darkMode?\"dark-page-bg\":\"\";document.querySelector(\"body\").className=!_this.state.darkMode?\"dark-page-bg\":\"\";};return _this;}_createClass(App,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;console.log(axiosInstance.defaults.headers[\"Authorization\"]);var refreshToken=localStorage.getItem(\"refresh_token\");if(refreshToken===\"undefined\"||refreshToken===null){localStorage.removeItem(\"currentUser\");}axios.get(apiURL+\"user/list/\").then(function(res){return _this2.setState({users:res.data});});if(18.5<new Date().getHours()||new Date().getHours()<7){console.log(\"Going Dark\");this.setState({darkMode:true});this.makePageDark();}}},{key:\"render\",value:function render(){var _this3=this;return/*#__PURE__*/_jsx(DarkContext.Provider,{value:{darkMode:this.state.darkMode,toggleDarkMode:this.toggleDarkMode,background:\"dark-bg\"},children:/*#__PURE__*/_jsx(UserContext.Provider,{value:{currentUser:this.state.currentUser,onLogIn:this.handleLoggedIn,getAuthor:this.getAuthorById},children:/*#__PURE__*/_jsxs(Router,{children:[/*#__PURE__*/_jsx(Header,{}),this.state.showSearchBar?/*#__PURE__*/_jsx(SearchBar,{}):\"\",/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsx(PrivateAdminRoute,{path:\"/admin\",toggleShowSearchBar:this.toggleShowSearchBar,users:this.state.users,component:AdminPage}),/*#__PURE__*/_jsx(IsAuthenticatedRoute,{path:\"/search\",component:SearchPage}),/*#__PURE__*/_jsx(IsAuthenticatedRoute,{path:\"/posts/:slug\",toggleShowSearchBar:this.toggleShowSearchBar,component:PostDetailWrapper}),/*#__PURE__*/_jsx(IsAuthenticatedRoute,{path:\"/update-post/:slug\",toggleShowSearchBar:this.toggleShowSearchBar,users:this.state.users,component:UpdatePost}),/*#__PURE__*/_jsx(IsAuthenticatedRoute,{path:\"/delete-post/:slug\",toggleShowSearchBar:this.toggleShowSearchBar,users:this.state.users,component:DeletePost}),/*#__PURE__*/_jsx(IsAuthenticatedRoute,{path:\"/create-post\",toggleShowSearchBar:this.toggleShowSearchBar,users:this.state.users,component:CreatePost}),/*#__PURE__*/_jsx(Route,{path:\"/login\",render:function render(props){return/*#__PURE__*/_jsx(LoginForm,_objectSpread({toggleShowSearchBar:_this3.toggleShowSearchBar},props));}}),/*#__PURE__*/_jsx(Route,{path:\"/register\",render:function render(props){return/*#__PURE__*/_jsx(RegisterForm,_objectSpread({toggleShowSearchBar:_this3.toggleShowSearchBar},props));}}),/*#__PURE__*/_jsx(IsAuthenticatedRoute,{path:\"/logout\",toggleShowSearchBar:this.toggleShowSearchBar,component:Logout}),/*#__PURE__*/_jsx(IsAuthenticatedRoute,{exact:true,path:\"/dashboard\",toggleShowSearchBar:this.toggleShowSearchBar,component:Dashboard}),/*#__PURE__*/_jsx(IsAuthenticatedRoute,{exact:true,path:\"/\",toggleShowSearchBar:this.toggleShowSearchBar,component:Body}),/*#__PURE__*/_jsx(Route,{path:\"*\",children:/*#__PURE__*/_jsx(NotFoundPage,{toggleShowSearchBar:this.toggleShowSearchBar})})]}),/*#__PURE__*/_jsx(Footer,{})]})})});}}]);return App;}(Component);export{App as default};var IsAuthenticatedRoute=function IsAuthenticatedRoute(_ref){var Component=_ref.component,toggleShowSearchBar=_ref.toggleShowSearchBar,users=_ref.users,rest=_objectWithoutProperties(_ref,_excluded);// Add your own authentication on the below line.\nvar refreshToken=localStorage.getItem(\"refresh_token\")===\"undefined\"||localStorage.getItem(\"refresh_token\")===null?false:true;return/*#__PURE__*/_jsx(Route,_objectSpread(_objectSpread({},rest),{},{render:function render(props){return refreshToken?/*#__PURE__*/_jsx(Component,_objectSpread(_objectSpread({},props),{},{users:users,toggleShowSearchBar:toggleShowSearchBar})):/*#__PURE__*/_jsx(Redirect,{to:{pathname:\"/login\",state:{from:props.location}}});}}));};var PrivateAdminRoute=function PrivateAdminRoute(_ref2){var Component=_ref2.component,toggleShowSearchBar=_ref2.toggleShowSearchBar,users=_ref2.users,rest=_objectWithoutProperties(_ref2,_excluded2);// Add your own authentication on the below line.\nvar refreshToken=localStorage.getItem(\"refresh_token\")===\"undefined\"||localStorage.getItem(\"refresh_token\")===null?false:true;var accessToken=localStorage.getItem(\"access_token\");if(!accessToken)return/*#__PURE__*/_jsx(Redirect,{to:\"/\"});var currentUserId=JSON.parse(atob(accessToken.split(\".\")[1])).user_id;var user=users.filter(function(user){return user.id===currentUserId;})[0];if(user){return/*#__PURE__*/_jsx(Route,_objectSpread(_objectSpread({},rest),{},{render:function render(props){return refreshToken&&user.is_superuser?/*#__PURE__*/_jsx(Component,_objectSpread(_objectSpread({},props),{},{users:users,toggleShowSearchBar:toggleShowSearchBar})):/*#__PURE__*/_jsx(Redirect,{to:{pathname:\"/not-allowed\",state:{from:props.location}}});}}));}return null;};","map":{"version":3,"sources":["C:/Users/kenny/Projects/drf_react_youpost/src/App.js"],"names":["Header","Footer","Body","Route","BrowserRouter","Router","Switch","Redirect","React","Component","RegisterForm","LoginForm","Logout","SearchPage","CreatePost","UserContext","DarkContext","apiURL","axios","SearchBar","PostDetailWrapper","NotFoundPage","UpdatePost","DeletePost","Dashboard","axiosInstance","AdminPage","App","state","currentUser","name","users","darkMode","showSearchBar","handleLoggedIn","username","user","setState","getAuthorById","pk","userName","find","id","toggleDarkMode","makePageDark","toggleShowSearchBar","boolInp","document","querySelector","className","console","log","defaults","headers","refreshToken","localStorage","getItem","removeItem","get","then","res","data","Date","getHours","background","onLogIn","getAuthor","props","IsAuthenticatedRoute","component","rest","pathname","from","location","PrivateAdminRoute","accessToken","currentUserId","JSON","parse","atob","split","user_id","filter","is_superuser"],"mappings":"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","sourcesContent":["import Header from \"./components/content/header\";\r\nimport Footer from \"./components/content/footer\";\r\nimport Body from \"./components/content/body\";\r\nimport {\r\n  Route,\r\n  BrowserRouter as Router,\r\n  Switch,\r\n  Redirect,\r\n} from \"react-router-dom\";\r\n\r\nimport React, { Component } from \"react\";\r\nimport RegisterForm from \"./components/actions/registerForm\";\r\nimport LoginForm from \"./components/actions/loginForm\";\r\nimport Logout from \"./components/actions/logout\";\r\nimport SearchPage from \"./components/content/searchPage\";\r\nimport CreatePost from \"./components/actions/createPost\";\r\n\r\nimport UserContext from \"./context/userContext\";\r\nimport DarkContext from \"./context/darkMode\";\r\n\r\nimport apiURL from \"./apiUrl\";\r\nimport axios from \"axios\";\r\nimport SearchBar from \"./components/actions/searchBar\";\r\nimport PostDetailWrapper from \"./components/content/postDetailWrapper\";\r\nimport NotFoundPage from \"./components/content/notFoundPage\";\r\nimport UpdatePost from \"./components/actions/updatePost\";\r\nimport DeletePost from \"./components/actions/deletePost\";\r\nimport Dashboard from \"./components/content/dashboard\";\r\nimport axiosInstance from \"./baseAxios\";\r\nimport AdminPage from \"./components/admin/adminPage\";\r\n\r\nexport default class App extends Component {\r\n  state = {\r\n    currentUser: { name: \"\" },\r\n    users: [],\r\n    darkMode: false,\r\n    showSearchBar: true,\r\n  };\r\n\r\n  handleLoggedIn = (username) => {\r\n    const user = { name: username };\r\n    this.setState({ currentUser: user });\r\n  };\r\n\r\n  componentDidMount() {\r\n    console.log(axiosInstance.defaults.headers[\"Authorization\"]);\r\n    const refreshToken = localStorage.getItem(\"refresh_token\");\r\n    if (refreshToken === \"undefined\" || refreshToken === null) {\r\n      localStorage.removeItem(\"currentUser\");\r\n    }\r\n\r\n    axios\r\n      .get(apiURL + \"user/list/\")\r\n      .then((res) => this.setState({ users: res.data }));\r\n\r\n    if (18.5 < new Date().getHours() || new Date().getHours() < 7) {\r\n      console.log(\"Going Dark\");\r\n      this.setState({ darkMode: true });\r\n      this.makePageDark();\r\n    }\r\n  }\r\n\r\n  getAuthorById = (pk) => {\r\n    if (pk) {\r\n      const userName = this.state.users.find((user) => user.id === pk)\r\n        ? this.state.users.find((user) => user.id === pk).username\r\n        : \"Anonymous\";\r\n      return userName;\r\n    }\r\n  };\r\n\r\n  toggleDarkMode = () => {\r\n    this.setState({ darkMode: !this.state.darkMode });\r\n    this.makePageDark();\r\n  };\r\n\r\n  toggleShowSearchBar = (boolInp) => {\r\n    this.setState({ showSearchBar: boolInp });\r\n  };\r\n\r\n  makePageDark = () => {\r\n    document.querySelector(\"html\").className = !this.state.darkMode\r\n      ? \"dark-page-bg\"\r\n      : \"\";\r\n\r\n    document.querySelector(\"body\").className = !this.state.darkMode\r\n      ? \"dark-page-bg\"\r\n      : \"\";\r\n  };\r\n\r\n  render() {\r\n    return (\r\n      <DarkContext.Provider\r\n        value={{\r\n          darkMode: this.state.darkMode,\r\n          toggleDarkMode: this.toggleDarkMode,\r\n          background: \"dark-bg\",\r\n        }}\r\n      >\r\n        <UserContext.Provider\r\n          value={{\r\n            currentUser: this.state.currentUser,\r\n            onLogIn: this.handleLoggedIn,\r\n            getAuthor: this.getAuthorById,\r\n          }}\r\n        >\r\n          <Router>\r\n            <Header />\r\n            {this.state.showSearchBar ? <SearchBar /> : \"\"}\r\n            <Switch>\r\n              <PrivateAdminRoute\r\n                path=\"/admin\"\r\n                toggleShowSearchBar={this.toggleShowSearchBar}\r\n                users={this.state.users}\r\n                component={AdminPage}\r\n              />\r\n\r\n              <IsAuthenticatedRoute path=\"/search\" component={SearchPage} />\r\n              <IsAuthenticatedRoute\r\n                path=\"/posts/:slug\"\r\n                toggleShowSearchBar={this.toggleShowSearchBar}\r\n                component={PostDetailWrapper}\r\n              />\r\n              <IsAuthenticatedRoute\r\n                path=\"/update-post/:slug\"\r\n                toggleShowSearchBar={this.toggleShowSearchBar}\r\n                users={this.state.users}\r\n                component={UpdatePost}\r\n              />\r\n              <IsAuthenticatedRoute\r\n                path=\"/delete-post/:slug\"\r\n                toggleShowSearchBar={this.toggleShowSearchBar}\r\n                users={this.state.users}\r\n                component={DeletePost}\r\n              />\r\n              <IsAuthenticatedRoute\r\n                path=\"/create-post\"\r\n                toggleShowSearchBar={this.toggleShowSearchBar}\r\n                users={this.state.users}\r\n                component={CreatePost}\r\n              />\r\n              <Route\r\n                path=\"/login\"\r\n                render={(props) => (\r\n                  <LoginForm\r\n                    toggleShowSearchBar={this.toggleShowSearchBar}\r\n                    {...props}\r\n                  />\r\n                )}\r\n              />\r\n              <Route\r\n                path=\"/register\"\r\n                render={(props) => (\r\n                  <RegisterForm\r\n                    toggleShowSearchBar={this.toggleShowSearchBar}\r\n                    {...props}\r\n                  />\r\n                )}\r\n              />\r\n              <IsAuthenticatedRoute\r\n                path=\"/logout\"\r\n                toggleShowSearchBar={this.toggleShowSearchBar}\r\n                component={Logout}\r\n              />\r\n              <IsAuthenticatedRoute\r\n                exact\r\n                path=\"/dashboard\"\r\n                toggleShowSearchBar={this.toggleShowSearchBar}\r\n                component={Dashboard}\r\n              />\r\n              <IsAuthenticatedRoute\r\n                exact\r\n                path=\"/\"\r\n                toggleShowSearchBar={this.toggleShowSearchBar}\r\n                component={Body}\r\n              />\r\n              <Route path=\"*\">\r\n                <NotFoundPage toggleShowSearchBar={this.toggleShowSearchBar} />\r\n              </Route>\r\n            </Switch>\r\n            <Footer />\r\n          </Router>\r\n        </UserContext.Provider>\r\n      </DarkContext.Provider>\r\n    );\r\n  }\r\n}\r\n\r\nconst IsAuthenticatedRoute = ({\r\n  component: Component,\r\n  toggleShowSearchBar,\r\n  users,\r\n  ...rest\r\n}) => {\r\n  // Add your own authentication on the below line.\r\n\r\n  const refreshToken =\r\n    localStorage.getItem(\"refresh_token\") === \"undefined\" ||\r\n    localStorage.getItem(\"refresh_token\") === null\r\n      ? false\r\n      : true;\r\n\r\n  return (\r\n    <Route\r\n      {...rest}\r\n      render={(props) =>\r\n        refreshToken ? (\r\n          <Component\r\n            {...props}\r\n            users={users}\r\n            toggleShowSearchBar={toggleShowSearchBar}\r\n          />\r\n        ) : (\r\n          <Redirect\r\n            to={{ pathname: \"/login\", state: { from: props.location } }}\r\n          />\r\n        )\r\n      }\r\n    />\r\n  );\r\n};\r\n\r\nconst PrivateAdminRoute = ({\r\n  component: Component,\r\n  toggleShowSearchBar,\r\n  users,\r\n  ...rest\r\n}) => {\r\n  // Add your own authentication on the below line.\r\n\r\n  const refreshToken =\r\n    localStorage.getItem(\"refresh_token\") === \"undefined\" ||\r\n    localStorage.getItem(\"refresh_token\") === null\r\n      ? false\r\n      : true;\r\n  const accessToken = localStorage.getItem(\"access_token\");\r\n\r\n  if (!accessToken) return <Redirect to={\"/\"} />;\r\n\r\n  const currentUserId = JSON.parse(atob(accessToken.split(\".\")[1])).user_id;\r\n\r\n  const user = users.filter((user) => user.id === currentUserId)[0];\r\n\r\n  if (user) {\r\n    return (\r\n      <Route\r\n        {...rest}\r\n        render={(props) =>\r\n          refreshToken && user.is_superuser ? (\r\n            <Component\r\n              {...props}\r\n              users={users}\r\n              toggleShowSearchBar={toggleShowSearchBar}\r\n            />\r\n          ) : (\r\n            <Redirect\r\n              to={{ pathname: \"/not-allowed\", state: { from: props.location } }}\r\n            />\r\n          )\r\n        }\r\n      />\r\n    );\r\n  }\r\n  return null;\r\n};\r\n"]},"metadata":{},"sourceType":"module"}